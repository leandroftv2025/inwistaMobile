# ====================================
# INWISTA - DUAL APPS NGINX CONFIG
# ====================================
# Configuração para servir inwistasite e inwistaMobile

# ----------------------------------------
# INWISTASITE (Site institucional)
# ----------------------------------------
server {
    listen 80;
    listen [::]:80;
    server_name 192.168.1.15 inwista.local;

    # Logs
    access_log /var/log/nginx/inwistasite_access.log;
    error_log /var/log/nginx/inwistasite_error.log;

    # Proxy para container inwistasite (porta 8080)
    location / {
        proxy_pass http://localhost:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;

        # Timeouts
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # Health check
    location /healthz {
        proxy_pass http://localhost:8080/healthz;
        access_log off;
    }
}

# ----------------------------------------
# INWISTAMOBILE (Aplicação web)
# ----------------------------------------
server {
    listen 80;
    listen [::]:80;
    server_name mobile.192.168.1.15.nip.io mobile.inwista.local;

    # Logs
    access_log /var/log/nginx/inwistamobile_access.log;
    error_log /var/log/nginx/inwistamobile_error.log;

    # Aumentar tamanho de upload (para imagens/documentos)
    client_max_body_size 10M;

    # Proxy para container inwistaMobile (porta 5000)
    location / {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;

        # Timeouts maiores para API
        proxy_connect_timeout 90s;
        proxy_send_timeout 90s;
        proxy_read_timeout 90s;
    }

    # Health check da API
    location /api/healthz {
        proxy_pass http://localhost:5000/api/healthz;
        access_log off;
    }
}
